!function(){"use strict";angular.module("AngularSvgNodes",[])}(),function(){"use strict";var a=function(){return{link:function(a,b,c){c.$observe("svgVbox",function(a){b[0].setAttribute("viewBox",a)})}}};angular.module("AngularSvgNodes").directive("svgVbox",a)}(),function(){"use strict";var a=function(){return{restrict:"EA",scope:{index:"@angularSvgNodesBgColGridIndex",onMouseOver:"&angularSvgNodesBgColGridOnMouseOver"},link:function(a,b){b[0].addEventListener("mouseover",function(){var b=_.parseInt(a.index);a.onMouseOver({index:b})})}}};angular.module("AngularSvgNodes").directive("angularSvgNodesBgColGrid",a)}(),function(){"use strict";var a=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=this,s=!1;this.blocks_waiting_for_connection=[],this.parent_coords=[],this.coords=[],this.blocks=[],this.bg_col_grid=[],this.bg_col_grid_hover_index=null,this.block_width=k,this.block_height=l,this.col_spacing=m,this.row_spacing=n,this.grid_col_count=i,this.grid_row_count=j,this.label_width=k-2*o,this.label_height=l-2*o,this.wrapper_style="",this.viewport_style="",this.viewport_width=0,this.viewport_height=0,this.viewport_viewbox="",this.selection=[],this.source_exit_side=null,this.onNodeSelect=function(b,c){return _.isUndefined(a.onNodeMouseDown)||a.onNodeMouseDown(r.getExtenalEventHandlerData(b,c)),r.blocks[c].columns[b].control?(this.onControlNodeSelect(b,c),!0):void this.onBlockNodeSelect(b,c)},this.onNodeDeselect=function(b,c){return _.isUndefined(a.onNodeMouseUp)||a.onNodeMouseUp(r.getExtenalEventHandlerData(b,c)),r.blocks[c].columns[b].control?!1:void this.onBlockNodeDeselect(b,c)},this.onNodeMouseOver=function(a,b){return r.blocks[b].columns[a].control?(r.onControlNodeMouseOver(a,b),!0):void r.onBlockNodeMouseOver(a,b)},this.onNodeMouseOut=function(a,b,c){return r.blocks[b].columns[a].control?(r.onControlNodeMouseOut(a,b),!0):void r.onBlockNodeMouseOut(a,b,c)},this.onControlNodeSelect=function(b,c){r.addBlock(b,c,"NEW",[]),a.$apply()},this.onControlNodeMouseOver=function(b,c){return r.selection.length>0?!1:(r.setNodeClass(b,c,"control_hover",!0),void a.$apply())},this.onControlNodeMouseOut=function(b,c){return r.selection.length>0?!1:(r.setNodeClass(b,c,"control_hover",!1),void a.$apply())},this.onBlockNodeSelect=function(b,c){r.setNodeClass(b,c,"source_hover",!1),r.setNodeClass(b,c,"source",!0),r.setPotentialNodeClasses(b,c,"potential_target_hover",!1),r.setPotentialNodeClasses(b,c,"potential_target",!0),r.selection=[[b,c]],a.$apply()},this.onBlockNodeDeselect=function(a,b){if(r.source_exit_side=null,1===r.selection.length?_.isEqual(r.selection[0],[a,b])&&(r.setNodeClass(a,b,"source",!1),r.setNodeClass(a,b,"source_hover",!0),r.setPotentialNodeClasses(a,b,"potential_target",!1),r.setPotentialNodeClasses(a,b,"potential_target_hover",!0)):2===r.selection.length&&_.isEqual(r.selection[1],[a,b])&&(r.setNodeClass(a,b,"target",!1),r.doesNodeHaveConnectedParents(a,b)||r.setPotentialNodeClasses(a,b,"potential_target",!1),r.checkActive()),2===r.selection.length&&_.isEqual(r.selection[1],[a,b])&&r.isNodePotential(r.selection[0],[a,b])){var c=r.selection[0][1]>b;c?r.removeLine(r.selection[1],r.selection[0]):(r.setAsConnectedLines(r.selection),r.checkActive())}},this.onBlockNodeMouseOver=function(b,c){0===r.selection.length&&(r.setNodeClass(b,c,"source_hover",!0),r.setPotentialNodeClasses(b,c,"potential_target_hover",!0)),2===r.selection.length&&r.isNodePotential(r.selection[0],[b,c])&&(r.setNodeClass(b,c,"potential_target",!1),r.setNodeClass(b,c,"target",!0),r.setLineClass(r.selection[0],[b,c],"target",!0)),r.bg_col_grid_hover_index!==b,a.$apply()},this.onBlockNodeMouseOut=function(b,c,d){if(0===r.selection.length?(r.setNodeClass(b,c,"source_hover",!1),r.setPotentialNodeClasses(b,c,"potential_target_hover",!1)):2===r.selection.length&&r.isNodePotential(r.selection[0],[b,c])&&(r.setNodeClass(b,c,"target",!1),r.setNodeClass(b,c,"potential_target",!0),r.setLineClass(r.selection[0],[b,c],"target",!1)),_.isEqual(r.selection[0],[b,c])&&_.isNull(r.source_exit_side)&&("top"===d?r.setPotentialChildNodeClasses(b,c,"potential_target",!1):"bottom"===d&&r.setPotentialParentNodeClasses(b,c,"potential_target",!1)),1===r.selection.length){_.isEqual(r.selection[0],[b,c])&&(r.source_exit_side=d);var e;if("top"===d)e=[r.bg_col_grid_hover_index,c-1],r.isNodePotential([b,c],e)&&r.selection.push(e);else if("bottom"===d){var f=c+1;e=[r.bg_col_grid_hover_index,f],Math.abs(r.selection[0][1]-f)<=1&&r.isNodePotential([b,c],e)&&r.selection.push(e)}}a.$apply()},this.onRootDeselect=function(){return r.source_exit_side=null,0===r.selection.length?!0:(r.selection.length>0&&(r.setNodeClass(r.selection[0][0],r.selection[0][1],"source",!1),r.setPotentialNodeClasses(r.selection[0][0],r.selection[0][1],"target",!1),r.setPotentialNodeClasses(r.selection[0][0],r.selection[0][1],"potential_target",!1)),2===r.selection.length&&r.removeUnconnectedLines(r.selection),r.selection.length>0&&(r.selection=[]),void a.$apply())},this.onBgColGridMouseOver=function(b){if(r.bg_col_grid_hover_index===b)return!0;if(r.bg_col_grid_hover_index=b,1===r.selection.length){var c="top"===r.source_exit_side?[b,r.selection[0][1]-1]:[b,r.selection[0][1]+1];r.isNodePotential(r.selection[0],c)&&r.selection.push(c)}else 2===r.selection.length&&r.isNodePotential(r.selection[0],[b,r.selection[1][1]])&&(r.selection[1][0]=b);a.$apply()},this.onRootMouseLeave=function(){1===r.selection.length?(r.setNodeClass(r.selection[0][0],r.selection[0][1],"source",!1),r.setPotentialNodeClasses(r.selection[0][0],r.selection[0][1],"potential_target",!1)):2===r.selection.length&&(r.setNodeClass(r.selection[0][0],r.selection[0][1],"source",!1),r.setNodeClass(r.selection[1][0],r.selection[1][1],"target",!1),r.setPotentialNodeClasses(r.selection[0][0],r.selection[0][1],"potential_target",!1)),2===r.selection.length&&r.removeUnconnectedLines(r.selection),r.selection=[],a.$apply()},this.onLineRemoveComplete=function(b,c,d){var e=r.blocks[b[1]].columns[b[0]];e.lines.splice(d,1),0===e.lines.length&&(r.doesNodeHaveConnectedParents(b[0],b[1])||r.setAsNotConnectedBlock([b[0],b[1]])),a.$apply()},this.onLineDrawComplete=function(b,c){var d=!1;_.forEach(r.blocks_waiting_for_connection,function(a,b){return _.isEqual(a,c)?(d=!0,r.blocks_waiting_for_connection.splice(b,1),!1):void 0}),d&&r.setAsConnectedBlock(c),a.$apply()},this.getExtenalEventHandlerData=function(b,c){var d=_.clone(a.rows[c].columns[b]),e=_.clone(r.blocks[c].columns[b]),f={node:e,data:null};return _.isUndefined(d)||(f.data=d),f},this.checkActive=function(){return 0===r.blocks.length?!1:void _.forEach(r.blocks[0].columns,function(a,b){a.lines.length>0&&r.activateBlock(b,0)})},this.activateBlock=function(a,b){var c=r.blocks[b].columns[a];c.active=!0,c.lines.length>0&&_.forEach(c.lines,function(a){a.active=!0,r.activateBlock(a.to[0],a.to[1])})},this.deactivateBlock=function(a,b){var c=r.blocks[b].columns[a];c.active=!1,c.lines.length>0&&_.forEach(c.lines,function(a){a.active=!1;var b=r.doesNodeHaveActiveParents(a.to[0],a.to[1]);b||r.deactivateBlock(a.to[0],a.to[1])})},this.doesNodeHaveActiveParents=function(a,b,c){if(0===b)return!1;var d=!1,e=b-1,f=r.blocks[e].columns;return _.forEach(f,function(f,g){_.forEach(f.lines,function(h){!_.isEqual([g,e],c)&&_.isEqual(h.to,[a,b])&&f.active&&(d=!0)})}),d},this.doesNodeHaveConnectedParents=function(a,b,c){if(0===b)return!1;_.isUndefined(c)&&(c=[]);var d=!1,e=b-1,f=r.blocks[e].columns;return _.forEach(f,function(f,g){return!_.isEqual([g,e],c)&&r.isNodePotential([a,b],[g,e])?(d=!0,!1):void 0}),d},this.isNodePotential=function(a,b){if(_.isUndefined(r.blocks[b[1]]))return!1;if(_.isUndefined(r.blocks[b[1]].columns[b[0]]))return!1;if(r.blocks[b[1]].columns[b[0]].control)return!1;if(a[1]===b[1])return!1;if(Math.abs(a[1]-b[1])>1)return!1;if(b[1]>=r.blocks.length)return!1;if(b[0]>=r.blocks[b[1]].columns.length)return!1;var c,d=b[1]<a[1],e=r.blocks[a[1]].columns[a[0]],f=r.blocks[b[1]].columns[b[0]];if(d){if(c=!1,"bottom"===r.source_exit_side)return!1;_.forEach(f.lines,function(b){return b.connected&&_.isEqual(b.to,a)?(c=!0,!1):void 0})}else{if(c=!0,"top"===r.source_exit_side)return!1;_.forEach(e.lines,function(a){return a.connected&&_.isEqual(a.to,b)?(c=!1,!1):void 0})}return c},this.setLineClass=function(a,b,c,d){_.forEach(r.blocks[a[1]].columns[a[0]].lines,function(a){_.isEqual(a.to,b)&&(a[c]=d)})},this.setNodeClass=function(a,b,c,d){r.blocks[b].columns[a][c]=d},this.setPotentialNodeClasses=function(a,b,c,d){r.setPotentialChildNodeClasses(a,b,c,d),r.setPotentialParentNodeClasses(a,b,c,d)},this.setPotentialChildNodeClasses=function(a,b,c,d){b+1<r.blocks.length&&_.forEach(r.blocks[b+1].columns,function(e,f){r.isNodePotential([a,b],[f,b+1])&&(e[c]=d)})},this.setPotentialParentNodeClasses=function(a,b,c,d){b>0&&_.forEach(r.blocks[b-1].columns,function(e,f){r.isNodePotential([a,b],[f,b-1])&&(e[c]=d)})},this.setViewport=function(a,b){var c=k+m,d=l+n;r.viewport_width=c*a,r.viewport_height=d*b,r.viewport_style={"background-color":"#ccc","min-width":r.viewport_width+"px","min-height":r.viewport_height+"px"},r.wrapper_style={"max-width":r.viewport_width+p+"px","min-width":r.viewport_width+"px","max-height":r.viewport_height+q*b+"px","min-height":r.viewport_height+"px"},r.viewport_viewbox=" 0 0 "+r.viewport_width+" "+r.viewport_height},this.checkViewport=function(a,b){var c=!1;b>=r.grid_row_count&&(r.grid_row_count++,c=!0),a>=r.grid_col_count&&(r.grid_col_count++,c=!0,r.addBgGridCol(r.grid_col_count-1)),c&&r.setViewport(r.grid_col_count,r.grid_row_count)},this.calculateColX=function(a){if(0===a)return 0;var b=k+m/2,c=k+m;return b+(a-1)*c},this.calculateColWidth=function(a){var b=0===a?k+m/2:k+m;return b},this.calculateRowY=function(a){var b=l+n;return a*b},this.calculateRowHeight=function(){return l+n},this.getCoords=function(a,f,g){var h=k+m,i=l+n,j=(a+1)*h-h,o=(f+1)*i-i,p=null;switch(g){case b:p=[j,o];break;case c:j+=k/2,p=[j,o];break;case d:j+=k/2,o+=l/2,p=[j,o];break;case e:j+=k/2,o+=l,p=[j,o]}return p},this.addLine=function(a,b,d){if(b[1]>=r.blocks.length)return!1;var f=r.getCoords(a[0],a[1],e),g=r.getCoords(b[0],b[1],c);r.blocks[a[1]].columns[a[0]].lines.push({connected:_.isUndefined(d)?!1:d,from:a,to:b,x1:f[0],y1:f[1],x2:g[0],y2:g[1]})},this.updateLineTarget=function(a,b){var d=r.getCoords(b[0],b[1],c);_.forEach(r.blocks[a[1]].columns[a[0]].lines,function(c){return _.isEqual(c.from,a)&&_.isEqual(c.to,b)?(c.x2=d[0],c.y2=d[1],c.to=b,!1):void 0})},this.removeLine=function(a,b){var c=r.getCoords(a[0],a[1],e);_.forEach(r.blocks[a[1]].columns[a[0]].lines,function(d){if(_.isEqual(d.from,a)&&_.isEqual(d.to,b)){var e=r.blocks[b[1]].columns[b[0]],f=r.doesNodeHaveConnectedParents(b[0],b[1],a);0!==e.lines.length||f||r.setAsNotConnectedBlock(b);var g=r.doesNodeHaveActiveParents(b[0],b[1],a);return g||r.deactivateBlock(b[0],b[1]),d.x2=c[0],d.y2=c[1],d.to=[a[0],a[1]],!1}})},this.removeUnconnectedLines=function(a){_.forEach(r.blocks[a[0][1]].columns[a[0][0]].lines,function(a){a.connected||r.removeLine(r.selection[0],r.selection[1])})},this.setAsConnectedLines=function(a){_.forEach(r.blocks[a[0][1]].columns[a[0][0]].lines,function(a){a.connected||(a.connected=!0,r.setAsConnectedBlock(a.from),r.setAsConnectedBlock(a.to))})},this.setAsConnectedBlock=function(a){r.blocks[a[1]].columns[a[0]].connected=!0},this.setAsNotConnectedBlock=function(a){r.blocks[a[1]].columns[a[0]].connected=!1},this.addBlock=function(a,d,f,g){if(d>r.blocks.length)throw new Error("Invalid row index");d===r.blocks.length&&r.blocks.push({columns:[]});var h;_.isUndefined(r.blocks[d].columns[a])||(h=r.blocks[d].columns.splice(a,1));var i=r.getCoords(a,d,b),j=[],k=r.getCoords(a,d,e);_.forEach(g,function(b){var e=[b,d+1],f=r.getCoords(e[0],e[1],c);j.push({connected:!0,from:[a,d],to:e,x1:k[0],y1:k[1],x2:f[0],y2:f[1]}),r.blocks_waiting_for_connection.push(e)});var l={x:i[0],y:i[1],label_x:i[0]+o,label_y:i[1]+o,label:f,connected:j.length>0,control:!1,row_index:d,col_index:a,lines:j};r.blocks[d].columns.push(l),r.checkViewport(a,d),_.isUndefined(h)||r.addControl(h[0].row_index)},this.addControl=function(a){if(a===r.blocks.length&&r.blocks.push({columns:[]}),a>=r.blocks.length)throw new Error("Invalid row index");var c=r.blocks[a].columns.length,e=r.getCoords(c,a,b),f=r.getCoords(c,a,d),g={x:e[0],y:e[1],label_x:f[0],label_y:f[1],label:"+",connected:!1,control:!0,row_index:a,col_index:c,lines:[]};r.blocks[a].columns.push(g),r.checkViewport(c,a)},this.addBgGridCol=function(a){r.bg_col_grid.push({index:a,x:r.calculateColX(a),width:r.calculateColWidth(a)})},a.$watch("ctrl.selection",function(a,b){_.isUndefined(a)||2===a.length&&a[1][1]>a[0][1]&&(a.length>b.length?r.addLine(r.selection[0],r.selection[1]):r.updateLineTarget(r.selection[0],r.selection[1]))},!0),a.$watchCollection("rows",function(a,b){if(!_.isUndefined(a)){if(!s)return r.init(a,"columns"),s=!0,!0;r.update(b,a,"columns")}}),this.init=function(a,b){for(var c=0;j>c;c++)c>=a.length&&a.push({columns:[]});_.forEach(a,function(a,c){_.forEach(a[b],function(a,b){r.addBlock(b,c,a.label,a.join)}),r.addControl(c)}),_.map(new Array(r.grid_col_count),function(a,b){r.addBgGridCol(b)}),r.setViewport(r.grid_col_count,r.grid_row_count),r.checkActive()},this.update=function(a,b,c){_.forEach(b,function(a,b){b>=r.blocks.length&&r.addControl(b)}),_.forEach(b,function(a,b){_.forEach(a[c],function(a,c){if(c>=r.blocks[b].columns.length-1){var d=_.has(a,"label")?a.label:"",e=_.has(a,"join")?a.join:[];r.addBlock(c,b,d,e)}})}),r.setViewport(r.grid_col_count,r.grid_row_count),r.checkActive()}};a.$inject=["$scope","BLOCK_TOP_LEFT","BLOCK_TOP","BLOCK_CENTER","BLOCK_BOTTOM","ACTION_ADD","ACTION_REMOVE","ACTION_UPDATE","INITIAL_GRID_COLS","INITIAL_GRID_ROWS","BLOCK_WIDTH","BLOCK_HEIGHT","COL_SPACING","ROW_SPACING","LABEL_SPACING","MAX_VIEWPORT_WIDTH_INCREASE","MAX_VIEWPORT_HEIGHT_INCREASE"],angular.module("AngularSvgNodes").controller("AngularSvgNodesController",a)}(),function(){"use strict";var a=function(){return{restrict:"EA",scope:{rows:"=angularSvgNodes",onNodeMouseDown:"&angularSvgNodesNodeMouseDown",onNodeMouseUp:"&angularSvgNodesNodeMouseUp"},replace:!0,controller:"AngularSvgNodesController as ctrl",link:function(a,b,c,d){d.parent_coords=b[0].getBoundingClientRect(),b.addClass("angular-svg-nodes"),b[0].addEventListener("mouseup",d.onRootDeselect),b[0].addEventListener("mouseleave",d.onRootMouseLeave)},templateUrl:"views/angular-svg-nodes.html"}};angular.module("AngularSvgNodes").directive("angularSvgNodes",a)}(),function(){"use strict";var a=function(){return{restrict:"EA",scope:{coords:"=angularSvgNodesLineCoords",col_index:"@angularSvgNodesLineColIndex",row_index:"@angularSvgNodesLineRowIndex",line_index:"@angularSvgNodesLineLineIndex",onRemoveComplete:"&angularSvgNodesLineOnRemoveComplete",onMoveComplete:"&angularSvgNodesLineOnMoveComplete",onDrawComplete:"&angularSvgNodesLineOnDrawComplete"},link:function(a,b){var c,d,e=.5,f=!1;a.$watch("coords",function(b,e){_.isUndefined(b)||(c=b.from,d=b.to,f?e.to[1]===b.to[1]&&e.to[0]!==b.to[0]?a.moveLine(b.x2):e.to[0]===b.to[0]&&e.to[1]!==b.to[1]?a.removeLine(b.x2,b.y2):e.to[1]!==b.to[1]&&e.to[0]!==b.to[0]&&b.to[1]<e.to[1]&&a.removeLine(b.x2,b.y2):(a.drawLine(b.x1,b.y1,b.x2,b.y2),f=!0))},!0),a.removeLine=function(a,c){TweenLite.to(b,e,{attr:{x2:a,y2:c},ease:Power4.easeOut,onComplete:g})},a.moveLine=function(a){TweenLite.to(b,e,{attr:{x2:a},ease:Power4.easeOut,onComplete:h})},a.drawLine=function(a,c,d,f){TweenLite.set(b,{attr:{x1:a,y1:c,x2:a,y2:c}}),TweenLite.to(b,e,{attr:{x2:d,y2:f},ease:Power4.easeOut,onComplete:i})};var g=function(){var b=_.parseInt(a.line_index);a.onRemoveComplete({source_coords:c,target_coords:d,line_index:b})},h=function(){var b=_.parseInt(a.line_index);a.onMoveComplete({source_coords:c,target_coords:d,line_index:b})},i=function(){var b=_.parseInt(a.line_index);a.onDrawComplete({source_coords:c,target_coords:d,line_index:b})}}}};angular.module("AngularSvgNodes").directive("angularSvgNodesLine",a)}(),function(){"use strict";var a=function(){return{restrict:"EA",scope:{col_index:"@angularSvgNodesNodeColIndex",row_index:"@angularSvgNodesNodeRowIndex",onSelect:"&angularSvgNodesNodeOnSelect",onDeselect:"&angularSvgNodesNodeOnDeselect",onMouseOver:"&angularSvgNodesNodeOnMouseOver",onMouseOut:"&angularSvgNodesNodeOnMouseOut"},link:function(a,b){b[0].addEventListener("mousedown",function(){var b=_.parseInt(a.col_index),c=_.parseInt(a.row_index);a.onSelect({col_index:b,row_index:c})}),b[0].addEventListener("mouseover",function(){var b=_.parseInt(a.col_index),c=_.parseInt(a.row_index);a.onMouseOver({col_index:b,row_index:c})}),b[0].addEventListener("mouseout",function(c){var d=b[0].getBoundingClientRect(),e=c.clientY,f=d.top+d.height/2,g=_.parseInt(a.col_index),h=_.parseInt(a.row_index),i=f>e?"top":"bottom";a.onMouseOut({col_index:g,row_index:h,exit_side:i})}),b[0].addEventListener("mouseup",function(){var b=_.parseInt(a.col_index),c=_.parseInt(a.row_index);a.onDeselect({col_index:b,row_index:c})})}}};angular.module("AngularSvgNodes").directive("angularSvgNodesNode",a)}(),function(){"use strict";angular.module("AngularSvgNodes").constant("BLOCK_TOP_LEFT",0).constant("BLOCK_TOP",1).constant("BLOCK_CENTER",2).constant("BLOCK_BOTTOM",3).constant("ACTION_ADD",0).constant("ACTION_REMOVE",1).constant("ACTION_UPDATE",2).constant("INITIAL_GRID_COLS",4).constant("INITIAL_GRID_ROWS",2).constant("BLOCK_WIDTH",80).constant("BLOCK_HEIGHT",80).constant("COL_SPACING",20).constant("ROW_SPACING",40).constant("LABEL_SPACING",5).constant("MAX_VIEWPORT_WIDTH_INCREASE",100).constant("MAX_VIEWPORT_HEIGHT_INCREASE",100)}();
//# sourceMappingURL=angular-svg-nodes.min.js.map